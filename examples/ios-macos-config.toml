# Code Scanner Configuration for iOS/macOS Projects (Swift + Objective-C)
# Human-focused checks - Xcode analyzer handles syntax/warnings.
#
# Copy this file to your project root as `config.toml`.

# ==============================================================================
# LLM Backend Configuration
# ==============================================================================

[llm]
# LM Studio (default)
backend = "lm-studio"   # Backend type: "lm-studio" or "ollama"
host = "localhost"       # Server hostname (usually localhost)
port = 1234              # Server port (LM Studio default: 1234, Ollama: 11434)
model = "qwen2.5-coder-7b-instruct"  # Optional for LM Studio
timeout = 600            # Request timeout in seconds
context_limit = 16384    # Context window size in tokens (minimum 16384 recommended)

# Ollama alternative (uncomment and comment out LM Studio above):
# backend = "ollama"     # Use Ollama backend
# host = "localhost"
# port = 11434           # Ollama default port
# model = "qwen3:4b"     # Model name (REQUIRED for Ollama)
# timeout = 600
# context_limit = 16384


# ==============================================================================
# Human-Focused Code Checks
# ==============================================================================

[[checks]]
pattern = "*.swift"
checks = [
    # Memory management checks
    "Check for strong reference cycles where weak or unowned is missing in closures.",
    "Check that delegates are declared as weak instead of strong.",
    "Check that timer and observer references are invalidated.",
    "Check that closures capturing self use [weak self] when needed.",
    "Check that large objects are not retained longer than necessary.",
    # Concurrency checks
    "Check that UI updates are performed on main thread using MainActor.",
    "Check for data races in async code.",
    "Check that actors are accessed with proper isolation.",
    "Check that continuation is resumed in async/await conversions.",
    "Check that Task cancellation is handled.",
    # Architectural checks
    "Check that view controllers do not make network calls directly.",
    "Check that business logic is not in views (SwiftUI) or view controllers.",
    "Check for god view controllers with too many responsibilities.",
    "Check for tight coupling between components.",
    "Check that dependency injection is used instead of hardcoded instantiation.",
    # Security checks
    "Check that sensitive data uses Keychain instead of UserDefaults.",
    "Check that API keys and secrets are not in code.",
    "Check that SSL certificate validation is not disabled.",
    "Check that sensitive information is not logged.",
    "Check that WebView does not allow arbitrary content.",
    # SwiftUI-specific checks
    "Check that state is not mutated in body property.",
    "Check that @StateObject vs @ObservedObject is used correctly.",
    "Check that Published properties are on main actor.",
    "Check that views are properly identifiable for animations.",
    "Check that environment objects are present in previews.",
    "Check for opportunities to optimize algorithms and data structures.",
]

[[checks]]
pattern = "*.m, *.mm"
checks = [
    # Objective-C memory checks
    "Check for retain cycles in blocks where __weak is missing.",
    "Check that properties are nil'd in dealloc when needed.",
    "Check that KVO observers are removed.",
    "Check that NSNotificationCenter observers are removed.",
    # Concurrency checks
    "Check for dispatch queue usage without proper synchronization.",
    "Check that main thread assertions are present for UI code.",
    "Check that @synchronized on self is not used as it can cause deadlocks.",
]

[[checks]]
pattern = "*"
checks = [
    "Check for dead code or unused files.",
    "Check for feature flags for features that have shipped.",
    "Check for duplicate implementations.",
    "Check that user-facing strings are localized.",
]
