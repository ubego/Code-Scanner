# Code Scanner Configuration for C++ Qt Projects
# Human-focused checks for Qt/QML applications.
#
# Copy this file to your project root as `config.toml`.

# ==============================================================================
# LLM Backend Configuration
# ==============================================================================

[llm]
# LM Studio (default)
backend = "lm-studio"   # Backend type: "lm-studio" or "ollama"
host = "localhost"       # Server hostname (usually localhost)
port = 1234              # Server port (LM Studio default: 1234, Ollama: 11434)
model = "qwen2.5-coder-7b-instruct"  # Optional for LM Studio
timeout = 600            # Request timeout in seconds
context_limit = 16384    # Context window size in tokens (minimum 16384 recommended)

# Ollama alternative (uncomment and comment out LM Studio above):
# backend = "ollama"     # Use Ollama backend
# host = "localhost"
# port = 11434           # Ollama default port
# model = "qwen3:4b"     # Model name (REQUIRED for Ollama)
# timeout = 600
# context_limit = 16384


# ==============================================================================
# Human-Focused Code Checks
# ==============================================================================

[[checks]]
pattern = "*.cpp, *.h, *.hpp"
checks = [
    # Qt-specific checks
    "Check that QObject-derived classes have the Q_OBJECT macro.",
    "Check that signals and slots are connected with matching signatures.",
    "Check for parent-child ownership confusion that could cause double deletion.",
    "Check that blocking operations are not performed on the main GUI thread.",
    "Check that worker threads have an event loop when needed.",
    # Memory and resource checks
    "Check that stack allocation is preferred over heap allocation for small, short-lived objects.",
    "Check that QObjects have a parent in non-obvious ownership scenarios.",
    "Check that Qt's parent-child memory management is used instead of manual management.",
    "Check that QSharedPointer or QScopedPointer is used for non-QObject resources.",
    "Check that QPointer is used to track connections to objects that may be deleted.",
    "Check that Qt's implicit sharing types are used for large allocations.",
    # Thread safety checks
    "Check that GUI operations are performed only on the main thread.",
    "Check that QObjects are used with proper thread affinity.",
    "Check that Qt::QueuedConnection is used for cross-thread signals.",
    "Check that shared data is synchronized when modified from multiple threads.",
    "Check that moveToThread() is called correctly.",
    # Architectural checks
    "Check that Model-View separation is maintained.",
    "Check that business logic is not placed in UI classes.",
    "Check for circular dependencies between modules.",
    "Check for god classes with too many responsibilities.",
    "Check for improper use of singletons.",
    # Performance checks
    "Check that QStringView is used for QString operations in tight loops.",
    "Check for unnecessary deep copies of implicitly shared types.",
    "Check that const references are used for container parameters.",
    "Check that expensive operations are not performed in paint events.",
    "Check that model updates do not trigger full view refreshes unnecessarily.",
    "Check for opportunities to optimize algorithms and data structures.",
]

[[checks]]
pattern = "*.qml"
checks = [
    # QML-specific checks
    "Check for property bindings that could cause binding loops.",
    "Check that JavaScript in QML is moved to C++ where appropriate.",
    "Check that items have an id when they need to be referenced.",
    "Check that declarative bindings are used instead of imperative JavaScript.",
    "Check that anchors and absolute positioning are not mixed incorrectly.",
    # QML performance checks
    "Check for complex JavaScript in binding expressions.",
    "Check that Loader is used for conditionally loaded content.",
    "Check that ListView and GridView use smart caching.",
    "Check that delegates do not create too many objects.",
    "Check that animations have proper GPU compositing hints.",
]

[[checks]]
pattern = "CMakeLists.txt, *.cmake"
checks = [
    # CMake best practices
    "Check that target-based commands (target_link_libraries, target_include_directories) are used instead of directory-based commands.",
    "Check that modern CMake (3.x) patterns are used instead of legacy patterns.",
    "Check that PRIVATE, PUBLIC, INTERFACE keywords are used correctly for target properties.",
    "Check that find_package(Qt6) or find_package(Qt5) includes all required components.",
    "Check that CMAKE_AUTOMOC, CMAKE_AUTORCC, and CMAKE_AUTOUIC are enabled for Qt projects.",
    # CMake organization
    "Check that CMakeLists.txt files are not overly long and are split into modules where appropriate.",
    "Check that hardcoded paths are avoided in favor of CMake variables and generator expressions.",
    "Check that qt_add_qml_module() is used for QML modules in Qt6 projects.",
    "Check that install() commands are provided for libraries and executables meant for distribution.",
    # CMake correctness
    "Check that dependencies between targets are correctly specified.",
    "Check that source files are not GLOB'd in a way that misses new files.",
    "Check that Qt resources (.qrc) are properly added to targets.",
]

[[checks]]
pattern = "*.pro, *.pri"
checks = [
    # qmake best practices
    "Check that QT += modules are listed explicitly and only include needed modules.",
    "Check that CONFIG += options are appropriate for the project type.",
    "Check that DEFINES are used instead of hardcoded preprocessor flags in QMAKE_CXXFLAGS.",
    "Check that INCLUDEPATH and LIBS are set correctly for external dependencies.",
    # qmake organization
    "Check that SOURCES, HEADERS, and FORMS are organized and not duplicated.",
    "Check that .pri files are used to share common settings across subprojects.",
    "Check that SUBDIRS projects have proper dependencies specified with .depends.",
    "Check that platform-specific blocks (win32, unix, macx) are used for platform-specific settings.",
    # qmake correctness
    "Check that RESOURCES includes all .qrc files needed by the project.",
    "Check that INSTALLS targets are defined for deployment.",
    "Check that VERSION and TARGET are set appropriately.",
    "Check that conditional includes (exists(), include()) have proper error handling.",
]

[[checks]]
pattern = "*"
checks = [
    "Check that implementation is in .cpp files rather than .h files except for templates.",
    "Check that forward declarations are used to reduce compilation coupling.",
    "Check for circular include dependencies.",
    "Check that private implementation details are not exposed in public headers.",
    "Check for entire files that are never imported or used.",
    "Check for feature flags or conditional code for features that shipped long ago.",
    "Check for commented-out code blocks larger than 3 lines.",
    "Check for TODO or FIXME comments that appear outdated.",
    "Check for duplicate implementations of similar logic across files.",
    "Check that all changed code paths handle edge cases and error conditions correctly.",
    "Check that the overall design fits the existing architecture and abstractions.",
    "Check that complex logic is broken down into small, understandable units with clear responsibilities.",
    "Check that names of variables, methods, and classes are clear, descriptive, and consistent.",
    "Check for obvious performance issues like N+1 queries or unnecessary loops.",
    "Check that database queries and external service calls are efficient and properly constrained.",
    "Check that public APIs, configuration changes, or new behaviors are properly documented.",
    "Check that comments and documentation are accurate, necessary, and up to date.",
    "Check that logging and error messages are clear, informative, and follow project conventions.",
    "Check that no sensitive data (keys, PII) is logged or exposed in output.",
    "Check that configuration changes have safe, sensible defaults.",
    "Check that feature flags are named consistently and reflect their purpose.",
]

# ==============================================================================
# Ignore Patterns (files and directories to skip during scanning)
# ==============================================================================
# Files and directories matching these patterns with empty checks will be ignored.
# Use /*dirname*/ syntax for directory patterns.
# Add or modify patterns as needed for your project.

[[checks]]
pattern = "*.md, *.txt, *.rst, *.html, *.json, *.toml, *.yaml, *.yml, /*test*/, /*tests*/, /*3rdparty*/, /*third_party*/, /*vendor*/, /*build*/, /*cmake-build-*/, /*qml-cache*/"
checks = []
