# Code Scanner Configuration for JavaScript/TypeScript Projects
# This example shows checks that require human judgment - not things ESLint catches.
#
# Copy this file to your project root as `config.toml` and customize as needed.

# ==============================================================================
# LLM Backend Configuration
# ==============================================================================

[llm]
# LM Studio (default)
backend = "lm-studio"   # Backend type: "lm-studio" or "ollama"
host = "localhost"       # Server hostname (usually localhost)
port = 1234              # Server port (LM Studio default: 1234, Ollama: 11434)
model = "qwen2.5-coder-7b-instruct"  # Optional for LM Studio
timeout = 600            # Request timeout in seconds
context_limit = 16384    # Context window size in tokens (minimum 16384 recommended)

# Ollama alternative (uncomment and comment out LM Studio above):
# backend = "ollama"     # Use Ollama backend
# host = "localhost"
# port = 11434           # Ollama default port
# model = "qwen3:4b"     # Model name (REQUIRED for Ollama)
# timeout = 600
# context_limit = 16384


# ==============================================================================
# Human-Focused Code Checks
# ==============================================================================

# React component checks
[[checks]]
pattern = "*.tsx, *.jsx"
checks = [
    # Component architecture checks
    "Check that components are not too large and should be split into smaller pieces.",
    "Check that business logic is separated from presentation using hooks or services.",
    "Check for props drilling through more than 3 levels that should use context or state management.",
    "Check that components do not both fetch data and render it (container/presenter pattern violation).",
    "Check that reusable components use props instead of hardcoded values.",
    # State management checks
    "Check that derived state is computed from source of truth instead of stored separately.",
    "Check for state that should be lifted up to a common ancestor.",
    "Check that global state is not used where local state would suffice.",
    "Check that state updates account for async race conditions.",
    "Check for missing optimistic updates that would improve UX.",
    # Memory leak and resource checks
    "Check that event listeners and subscriptions are cleaned up in useEffect.",
    "Check that timers (setInterval/setTimeout) are cleaned up properly.",
    "Check that fetch requests use AbortController for cancellation.",
    "Check that WebSocket connections are properly closed.",
    "Check that large data is not cached in component state indefinitely.",
    # User experience checks
    "Check for missing loading states for async operations.",
    "Check for missing error boundaries around error-prone components.",
    "Check that forms have proper validation feedback.",
    "Check for missing confirmation dialogs for destructive operations.",
    "Check for missing keyboard navigation for interactive elements.",
]

# TypeScript checks
[[checks]]
pattern = "*.ts, *.tsx"
checks = [
    "Check that external API responses are validated at runtime.",
    "Check that type assertions (as) are safe and will not fail at runtime.",
    "Check that stricter types are used instead of Partial<T> where possible.",
    "Check that union types cover all possible cases.",
    "Check that generic types are not too permissive (T extends any).",
]

# General JS/TS checks
[[checks]]
pattern = "*.js, *.ts, *.jsx, *.tsx"
checks = [
    # Security checks
    "Check that dangerouslySetInnerHTML does not use unsanitized content.",
    "Check that user input in URL construction is properly encoded.",
    "Check that sensitive data is not stored in localStorage or sessionStorage.",
    "Check that API keys or secrets are not in client-side code.",
    "Check that eval() or Function() is not used with dynamic input.",
    "Check for prototype pollution vulnerabilities.",
    # API and data handling checks
    "Check that fetch calls have proper error handling.",
    "Check that API responses are checked for null or undefined before use.",
    "Check for incorrect Content-Type headers in requests.",
    "Check that CORS considerations are handled for cross-origin requests.",
    "Check for inconsistent date and time handling mixing Date objects and strings.",
    # Performance checks
    "Check that large synchronous operations do not block the main thread.",
    "Check for unnecessary re-renders caused by object or array reference changes.",
    "Check for missing pagination for large data sets.",
    "Check for unbounded growth of in-memory caches.",
    "Check for network waterfalls where sequential requests could be parallel.",
    "Check for opportunities to optimize algorithms and data structures.",
]

[[checks]]
pattern = "*"
checks = [
    "Check for entire files that are never imported or used.",
    "Check for feature flags or conditional code for features that shipped long ago.",
    "Check for commented-out code blocks larger than 3 lines.",
    "Check for TODO or FIXME comments that appear outdated.",
    "Check for duplicate implementations of similar logic across files.",
    "Check for repeated code blocks that can be extracted into a separate function.",
    "Check that all changed code paths handle edge cases and error conditions correctly.",
    "Check that the overall design fits the existing architecture and abstractions.",
    "Check that complex logic is broken down into small, understandable units with clear responsibilities.",
    "Check that names of variables, methods, and classes are clear, descriptive, and consistent.",
    "Check for obvious performance issues like N+1 queries or unnecessary loops.",
    "Check that database queries and external service calls are efficient and properly constrained.",
    "Check that public APIs, configuration changes, or new behaviors are properly documented.",
    "Check that comments and documentation are accurate, necessary, and up to date.",
    "Check that logging and error messages are clear, informative, and follow project conventions.",
    "Check that no sensitive data (keys, PII) is logged or exposed in output.",
    "Check that configuration changes have safe, sensible defaults.",
    "Check that feature flags are named consistently and reflect their purpose.",
]

# ==============================================================================
# Ignore Patterns (files and directories to skip during scanning)
# ==============================================================================
# Files and directories matching these patterns with empty checks will be ignored.
# Use /*dirname*/ syntax for directory patterns.
# Add or modify patterns as needed for your project.

[[checks]]
pattern = "*.md, *.txt, *.rst, *.html, *.json, *.toml, *.yaml, *.yml, /*test*/, /*tests*/, /*__tests__*/, /*external*/, /*3rdparty*/, /*third_party*/, /*vendor*/, /*node_modules*/, /*dist*/, /*build*/, /*.next*/"
checks = []
