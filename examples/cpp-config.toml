# Code Scanner Configuration for C++ Projects
# This example shows common checks for modern C++ codebases
#
# Copy this file to your project root as `config.toml` and customize as needed.

# ==============================================================================
# LLM Backend Configuration
# ==============================================================================
# Choose ONE of the backend configurations below (LM Studio or Ollama)

[llm]
# -----------------------------------------------------------------------------
# Option 1: LM Studio
# -----------------------------------------------------------------------------
# Download: https://lmstudio.ai
# Load a model in LM Studio and start the local server

backend = "lm-studio"
host = "localhost"
port = 1234
model = "qwen/qwen3-4b-thinking-2507"
timeout = 120
# context_limit = 32768  # Context window size in tokens

# -----------------------------------------------------------------------------
# Option 2: Ollama (comment out LM Studio section above, uncomment below)
# -----------------------------------------------------------------------------
# Install: https://ollama.ai/download
# Pull a model: ollama pull qwen3:4b
# Start server: ollama serve (runs automatically on macOS/Linux)

# backend = "ollama"
# host = "localhost"
# port = 11434
# model = "qwen3:4b"  # Required for Ollama
# timeout = 120
# context_limit = 8192


# ==============================================================================
# Code Quality Checks
# ==============================================================================

# C++ source file checks
[[checks]]
pattern = "*.cpp, *.cxx, *.cc"
rules = [
    """
    Check for memory management issues.
    Flag:
    - Raw new/delete instead of smart pointers (unique_ptr, shared_ptr)
    - Missing delete for new allocations
    - delete on array allocated with new[] (should use delete[])
    - Potential memory leaks in exception paths
    - Manual memory management where RAII could be used
    Do NOT flag:
    - Placement new for custom allocators
    - Low-level system code with documented ownership
    """,
    """
    Check for undefined behavior risks.
    Flag:
    - Dereferencing potentially null pointers
    - Array out-of-bounds access
    - Use after free
    - Signed integer overflow
    - Uninitialized variable usage
    - Data races on shared variables
    """,
    """
    Check for modern C++ best practices.
    Flag:
    - Using NULL instead of nullptr
    - C-style casts instead of static_cast/dynamic_cast/reinterpret_cast
    - #define constants instead of constexpr
    - typedef instead of using
    - Old-style for loops where range-based for would work
    - std::bind instead of lambdas
    - Raw function pointers instead of std::function
    """,
    """
    Check for performance issues.
    Flag:
    - Passing large objects by value instead of const reference
    - Missing move semantics for movable objects
    - Unnecessary copies in range-based for (should use const auto&)
    - String concatenation in loops instead of ostringstream
    - Virtual function calls in tight loops
    - Missing noexcept on move operations
    """,
]

# Header file checks
[[checks]]
pattern = "*.h, *.hpp, *.hxx"
rules = [
    """
    Check for header file issues.
    Flag:
    - Missing include guards or #pragma once
    - Function definitions in headers (except inline/template/constexpr)
    - Using namespace in headers
    - Unnecessary includes (forward declarations would suffice)
    - Missing forward declarations causing circular dependencies
    - Non-inline variable definitions in headers (ODR violations)
    """,
    """
    Check for API design issues in headers.
    Flag:
    - Public member variables (should use getters/setters)
    - Missing virtual destructor in base classes with virtual methods
    - Missing explicit on single-argument constructors
    - Missing const on methods that don't modify state
    - Exposing implementation details in public interface
    """,
]

# General checks
[[checks]]
pattern = "*"
rules = [
    """
    Check for security vulnerabilities.
    Flag:
    - Buffer overflow risks (strcpy, sprintf, gets)
    - Format string vulnerabilities
    - Integer overflow in size calculations
    - Use of deprecated insecure functions
    - Command injection risks
    - Hardcoded credentials
    """,
]
