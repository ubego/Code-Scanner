# Code Scanner Configuration for C++ Projects
# Human-focused checks - compilers and clang-tidy handle syntax/warnings.
#
# Copy this file to your project root as `config.toml`.

# ==============================================================================
# LLM Backend Configuration
# ==============================================================================

[llm]
# LM Studio (default)
backend = "lm-studio"   # Backend type: "lm-studio" or "ollama"
host = "localhost"       # Server hostname (usually localhost)
port = 1234              # Server port (LM Studio default: 1234, Ollama: 11434)
model = "qwen2.5-coder-7b-instruct"  # Optional for LM Studio
timeout = 600            # Request timeout in seconds
context_limit = 16384    # Context window size in tokens (minimum 16384 recommended)

# Ollama alternative (uncomment and comment out LM Studio above):
# backend = "ollama"     # Use Ollama backend
# host = "localhost"
# port = 11434           # Ollama default port
# model = "qwen3:4b"     # Model name (REQUIRED for Ollama)
# timeout = 600
# context_limit = 16384


# ==============================================================================
# Human-Focused Code Checks
# ==============================================================================

[[checks]]
pattern = "*.cpp, *.cc, *.cxx, *.hpp, *.h"
checks = [
    # Memory management checks
    "Check that stack allocation is preferred over heap allocation for small, short-lived objects.",
    "Check that smart pointers (unique_ptr, shared_ptr) are used instead of raw pointers where appropriate.",
    "Check that RAII patterns are used instead of manual new/delete.",
    "Check that base classes with virtual methods have virtual destructors.",
    "Check for object slicing when copying derived classes.",
    "Check for dangling pointers after object destruction.",
    "Check for double-free vulnerabilities.",
    # Resource leak checks
    "Check that file handles are closed on all code paths.",
    "Check that network connections and sockets are properly released.",
    "Check that mutexes are unlocked on exception paths using lock_guard.",
    "Check that memory allocated in constructor is freed on partial construction failure.",
    # Concurrency checks
    "Check for data races on shared mutable state.",
    "Check for deadlock potential from inconsistent lock ordering.",
    "Check for missing memory barriers or atomic operations.",
    "Check that condition variables are used with proper predicates.",
    "Check for thread-unsafe initialization of local statics using pre-C++11 patterns.",
    # Undefined behavior checks
    "Check for signed integer overflow.",
    "Check for dereferencing nullptr or uninitialized pointers.",
    "Check for use-after-move of moved-from objects.",
    "Check for out-of-bounds array access.",
    "Check for modifying const objects through casts.",
    "Check for strict aliasing rule violations.",
    # Design checks
    "Check that classes have a single responsibility.",
    "Check for circular dependencies between modules.",
    "Check for god classes with too many methods.",
    "Check for deeply nested inheritance hierarchies.",
    "Check for overuse of friend classes breaking encapsulation.",
    # Modern C++ checks
    "Check that STL algorithms are used instead of raw loops where appropriate.",
    "Check that static_cast or dynamic_cast is used instead of C-style casts.",
    "Check that std::string or string_view is used instead of manual string handling.",
    "Check that std::function is used instead of function pointers where clearer.",
    "Check that move operations are marked noexcept.",
    "Check for opportunities to optimize algorithms and data structures.",
]

[[checks]]
pattern = "*"
checks = [
    "Check for headers that are included but not used.",
    "Check for circular header dependencies.",
    "Check that implementation details are not exposed in headers.",
    "Check that include guards or #pragma once is present.",
    "Check for dead code or unused files.",
    "Check for feature flags for features that have shipped.",
    "Check for duplicate implementations.",
    "Check that all changed code paths handle edge cases and error conditions correctly.",
    "Check that the overall design fits the existing architecture and abstractions.",
    "Check that complex logic is broken down into small, understandable units with clear responsibilities.",
    "Check that names of variables, methods, and classes are clear, descriptive, and consistent.",
    "Check for obvious performance issues like N+1 queries or unnecessary loops.",
    "Check that database queries and external service calls are efficient and properly constrained.",
    "Check that public APIs, configuration changes, or new behaviors are properly documented.",
    "Check that comments and documentation are accurate, necessary, and up to date.",
    "Check that logging and error messages are clear, informative, and follow project conventions.",
    "Check that no sensitive data (keys, PII) is logged or exposed in output.",
    "Check that configuration changes have safe, sensible defaults.",
    "Check that feature flags are named consistently and reflect their purpose.",
]
